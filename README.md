Library of bpipe functions for processing minc files
====================================================

minc-bpipe-library provides a set of chainable minc file processing functions to (pre)process data.

It requires http://www.bic.mni.mcgill.ca/ServicesSoftware/ServicesSoftwareMincToolKit, https://stnava.github.io/ANTs/, and https://github.com/ssadedin/bpipe/

To control which stages are run, edit ``pipeline.bpipe`` and add stage names using "+" to the "run" stage.

Stages are listed in the ``minc-library.bpipe``, correction stages such as denoising, n3 and n4, and normalize
should be run before any other stages. Typically after this ``linear_register`` would be run, which will
allow other processing such as VBM, cutneck, deface and beast.

For convenience, "segments" have been defined for some processing jobs (beast, cutneck, VBM) which are multi-step.
These will conflict with each other if you try to combine them, so instead you must specifiy their individual stages.

Stage options have been chosen based on best pratices from publications where applicable but can be changed.

Once you have defined your stages, you can run your pipeline on the SGE cluster with:
```
> module load bpipe #needed to run bpipe
> module load minc-toolkit/1.0.04 #needed for most stages
> module load ANTs/2.1.0 #Needed for n4correct
#Choose n to be the smaller of (number of input files, 240)
> bpipe run -n<number> -d /path/to/store/outputs /path/to/pipeline.bpipe /path/to/inputs/*mnc
```

Output filenames from bpipe will be of the form ``<inputname>.stage1.stage2.stage3.ext`` where the last stage
name will be the last run. ``commandlog.txt`` will be generated by bpipe describing all the commands run for
the pipeline. This is a very good file to keep around as as a note of what happened to your data.

Some stages produce both ``mnc`` files and ``xfm`` files, see the ``$output`` variables for what is generated.

#Scinet Operation
New (experimental) operation on SciNet is now implemented

Steps

1. Comment output the queueing details in bpipe.config
2. ``sed -i 's#/opt/quarantine#/project/m/mchakrav/quarantine#/g' minc-library.bpipe``
3. Use ``bpipe-batch.sh /path/to/pipeline.bpipe <list of files>`` to generate a joblist
4. Use ``qbatch joblist 1 12:00:00`` to submit jobs to scinet queing system
